// ============================================================================
// Ring Oscillator Module
// ============================================================================
// 环形振荡器 - 用于TDC自校准
// 从VHDL ro.vhd转换而来
// ============================================================================

`timescale 1ns / 1ps
`include "tdc_pkg.vh"

module ro #(
    parameter LENGTH = `RO_LENGTH       // 振荡器链长度(必须为奇数)
)(
    input  wire en,                     // 使能信号
    output wire ro_clk                  // 振荡器输出时钟
);

    // ========================================================================
    // 内部信号
    // ========================================================================
    (* DONT_TOUCH = "TRUE" *)
    wire [LENGTH:0] path;               // 振荡路径
    
    // ========================================================================
    // 反馈连接
    // ========================================================================
    assign path[0] = path[LENGTH];
    assign ro_clk = path[LENGTH];

    // ========================================================================
    // LUT链生成
    // ========================================================================
    genvar i;
    generate
        // 第一个LUT - 使能门控
        begin : gen_lut_0
            (* DONT_TOUCH = "TRUE" *)
            LUT2 #(
                .INIT(4'b0100)          // 当I1=1时输出I0的反相
            ) lut_gate (
                .O(path[1]),
                .I0(path[0]),
                .I1(en)
            );
        end
        
        // 后续LUT - 反相器链
        for (i = 1; i < LENGTH; i = i + 1) begin : gen_lut_chain
            (* DONT_TOUCH = "TRUE" *)
            LUT1 #(
                .INIT(2'b01)            // 反相器
            ) lut_inv (
                .O(path[i+1]),
                .I0(path[i])
            );
        end
    endgenerate

endmodule
